# Feature: 1.1.2 Configure LLM Provider Settings

## Problem Statement

JidoCode needs a configuration system for LLM providers that:
- Supports 50+ providers via JidoAI/ReqLLM integration
- Requires explicit configuration (no defaults)
- Validates provider existence and API key availability
- Supports environment variable overrides

### Impact Analysis
- **Scope**: Core configuration infrastructure used by all LLM interactions
- **Dependencies**: Depends on task 1.1.1 (project structure) - completed
- **Risk**: Medium - must integrate correctly with JidoAI's Keyring system

## Solution Overview

Create a `JidoCode.Config` module that:
1. Reads configuration from `:jido_code, :llm` application env
2. Supports environment variable overrides (`JIDO_CODE_PROVIDER`, `JIDO_CODE_MODEL`)
3. Validates provider against `Jido.AI.Provider.providers/0`
4. Validates API key exists via `Jido.AI.Keyring`
5. Fails fast if no provider is configured

### JidoAI Integration Points

**Provider validation:**
- `Jido.AI.Provider.providers/0` returns list of `{provider_atom, adapter}` tuples
- Supports 50+ providers via ReqLLM registry

**API Key validation:**
- `Jido.AI.Keyring.get/3` retrieves API keys
- Keys follow naming convention: `:anthropic_api_key`, `:openai_api_key`, etc.
- Environment variables: `ANTHROPIC_API_KEY`, `OPENAI_API_KEY`, etc.

## Technical Details

### Configuration Schema

```elixir
config :jido_code, :llm,
  provider: :anthropic,           # Required - atom
  model: "claude-3-5-sonnet",     # Required - string
  temperature: 0.7,               # Optional - float 0.0-2.0
  max_tokens: 4096                # Optional - integer
```

### Environment Variable Overrides

| Env Var | Config Key | Example |
|---------|-----------|---------|
| `JIDO_CODE_PROVIDER` | `:provider` | `anthropic` |
| `JIDO_CODE_MODEL` | `:model` | `claude-3-5-sonnet` |

### File Locations

- `lib/jido_code/config.ex` - Main config module
- `test/jido_code/config_test.exs` - Config tests
- `config/runtime.exs` - Already exists from task 1.1.1

## Success Criteria

- [x] `Config.get_llm_config/0` returns `{:ok, config}` when properly configured
- [x] Returns `{:error, reason}` when provider missing
- [x] Returns `{:error, reason}` when API key missing
- [x] Environment variables override config file values
- [x] All tests pass (13 tests)

## Implementation Plan

### Step 1: Update runtime.exs ✅
- [x] Config structure already in place from task 1.1.1

### Step 2: Create JidoCode.Config module ✅
- [x] Define `get_llm_config/0` function
- [x] Define `get_llm_config!/0` for startup failures
- [x] Define `configured?/0` for checking state
- [x] Implement provider validation via `Jido.AI.Provider.providers/0`
- [x] Implement API key validation via env vars and Keyring fallback
- [x] Support env var overrides (JIDO_CODE_PROVIDER, JIDO_CODE_MODEL)

### Step 3: Write tests ✅
- [x] Test valid configuration
- [x] Test missing provider error
- [x] Test missing model error
- [x] Test invalid provider error
- [x] Test missing API key error
- [x] Test env var overrides
- [x] Test empty env vars fall back to config
- [x] Test `get_llm_config!/0` raises on error
- [x] Test `configured?/0` returns boolean

## Current Status

**Status**: ✅ Complete
**Branch**: `feature/1.1.2-llm-provider-config`

### What Works
- Full `JidoCode.Config` module with validation
- Environment variable overrides
- Provider validation against JidoAI registry (50+ providers)
- API key validation via env vars with Keyring fallback
- 13 passing tests

### API Summary

```elixir
# Get validated config (returns {:ok, config} or {:error, reason})
{:ok, config} = JidoCode.Config.get_llm_config()

# Get config or raise (for startup)
config = JidoCode.Config.get_llm_config!()

# Check if configured
JidoCode.Config.configured?()  # => true/false
```

### How to Run
```bash
# Run tests
mix test test/jido_code/config_test.exs

# Configure via env vars
export JIDO_CODE_PROVIDER=anthropic
export JIDO_CODE_MODEL=claude-3-5-sonnet
export ANTHROPIC_API_KEY=your_key_here
```
