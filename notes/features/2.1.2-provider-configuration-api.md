# Feature: 2.1.2 Provider Configuration API

**Branch**: `feature/2.1.2-provider-configuration-api`
**Phase**: Phase 2 - LLM Agent with Chain-of-Thought Reasoning

## Problem Statement

The LLMAgent needs runtime API for switching LLM providers and models without restart. Users should be able to hot-swap between providers (e.g., switch from Anthropic to OpenAI) and the system should validate provider availability, model existence, and API key presence.

## Solution Overview

Add `configure/2` function to LLMAgent that:
1. Validates provider exists in ReqLLM registry
2. Validates model exists for provider
3. Validates API key is available
4. Restarts internal AI agent with new configuration
5. Broadcasts config change events for TUI

## Technical Details

### Key JidoAI APIs (from research)
```elixir
# List providers
Jido.AI.Model.Registry.Adapter.list_providers()
# => {:ok, [:anthropic, :openai, ...]}

# Check model exists
Jido.AI.Model.Registry.Adapter.model_exists?(provider, model_name)
# => true/false

# Get model info
Jido.AI.Model.Registry.Adapter.get_model(provider, model_name)
# => {:ok, %ReqLLM.Model{...}}

# Check API key
Jido.AI.Keyring.get(:provider_api_key, nil)
Jido.AI.Keyring.has_value?(api_key)
```

### Files to Modify
- `lib/jido_code/agents/llm_agent.ex` - Add configure/2 and validation
- `test/jido_code/agents/llm_agent_test.exs` - Add tests

## Implementation Plan

### Step 1: Add configure/2 function
- [ ] Add `configure/2` client API
- [ ] Add `handle_call({:configure, opts}, ...)` callback
- [ ] Implement validation pipeline

### Step 2: Add validation functions
- [ ] `validate_provider/1` - Check provider in registry
- [ ] `validate_model/2` - Check model exists for provider
- [ ] `validate_api_key/1` - Check API key available

### Step 3: Implement hot-swap logic
- [ ] Stop existing AI agent
- [ ] Start new AI agent with new config
- [ ] Update state

### Step 4: Add PubSub broadcast
- [ ] Broadcast `{:config_changed, old_config, new_config}` event

### Step 5: Write tests
- [ ] Test configure with valid provider/model
- [ ] Test configure with invalid provider
- [ ] Test configure with invalid model
- [ ] Test configure with missing API key
- [ ] Test config change broadcast

### Step 6: Update phase plan
- [ ] Mark task complete in phase-02.md

## Success Criteria

1. configure/2 validates provider, model, and API key
2. Returns descriptive errors for invalid configurations
3. Hot-swaps AI agent without restart
4. Broadcasts config change events
5. All tests pass

## Current Status

- [x] Step 1: Add configure/2 function
- [x] Step 2: Add validation functions
- [x] Step 3: Implement hot-swap logic
- [x] Step 4: Add PubSub broadcast
- [x] Step 5: Write tests
- [x] Step 6: Update phase plan

## What Works

- `configure/2` validates provider, model, and API key before applying changes
- Hot-swaps AI agent without restarting LLMAgent GenServer
- Broadcasts `{:config_changed, old_config, new_config}` to PubSub for TUI
- Returns descriptive error messages for invalid configurations
- `list_providers/0` returns available providers from ReqLLM registry
- `list_models/1` returns model names for a given provider
- All 15 LLMAgent tests pass

## Files Modified

- `lib/jido_code/agents/llm_agent.ex` - Added configure/2, list_providers/0, list_models/1, validation functions
- `test/jido_code/agents/llm_agent_test.exs` - Added 8 new tests for configure/2 and list functions

## API Examples

```elixir
# List available providers
{:ok, providers} = JidoCode.Agents.LLMAgent.list_providers()
# => {:ok, [:anthropic, :openai, :google, ...]}

# List models for a provider
{:ok, models} = JidoCode.Agents.LLMAgent.list_models(:anthropic)
# => {:ok, ["claude-3-5-sonnet-20241022", "claude-3-opus-20240229", ...]}

# Reconfigure at runtime
:ok = JidoCode.Agents.LLMAgent.configure(pid, provider: :openai, model: "gpt-4o")

# Invalid provider returns error
{:error, "Provider 'invalid' not found..."} = JidoCode.Agents.LLMAgent.configure(pid, provider: :invalid)
```
