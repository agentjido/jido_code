# Feature 4.2.1: Main Layout Structure

## Problem Statement

The TUI currently has a minimal placeholder view. Users need a proper three-pane layout to interact with the assistant:

1. **Status bar** (top) - Shows provider, model, and agent status
2. **Conversation area** (middle) - Displays message history with scrolling
3. **Input bar** (bottom) - Shows prompt indicator and current input

**Impact**: Without proper layout, users cannot effectively use the TUI for conversations.

## Solution Overview

Implement a complete view/1 function that renders a three-pane vertical layout using TermUI's stack, text, and box primitives. The layout adapts to terminal dimensions stored in Model.window.

### Layout Structure

```
┌─────────────────────────────────────────────┐
│ anthropic:claude-3-5-sonnet | Status: Idle  │ <- Status bar (1 line)
├─────────────────────────────────────────────┤
│                                             │
│ You: Hello there                            │ <- Conversation area
│                                             │    (fills remaining space)
│ Assistant: Hello! How can I help you?       │
│                                             │
├─────────────────────────────────────────────┤
│ > Type your message here_                   │ <- Input bar (1 line)
└─────────────────────────────────────────────┘
```

### Design Decisions

1. **Vertical Stack Layout**: Use `stack(:vertical, ...)` for main layout
2. **Fixed Heights**: Status bar (1 line), input bar (1 line), conversation fills rest
3. **Color Scheme**: User messages cyan, assistant white, status bar blue background
4. **Input Indicator**: ">" prefix followed by input buffer and cursor indicator

## Implementation Plan

### Step 1: Refactor view/1 for Three-Pane Layout
- [x] 1.1 Replace existing view with stack-based layout
- [x] 1.2 Create render_status_bar/1 component (already exists, enhance)
- [x] 1.3 Create render_conversation/1 component
- [x] 1.4 Create render_input_bar/1 component
- [x] 1.5 Compose all panes in view/1

### Step 2: Implement Status Bar
- [x] 2.1 Display provider:model on left side
- [x] 2.2 Display status indicator (idle/processing/error/unconfigured)
- [x] 2.3 Add keyboard shortcut hints on right side
- [x] 2.4 Apply blue background styling

### Step 3: Implement Conversation Area
- [x] 3.1 Create render_messages/2 helper
- [x] 3.2 Display user messages with "You:" prefix in cyan
- [x] 3.3 Display assistant messages with "Assistant:" prefix in white
- [x] 3.4 Handle empty conversation state
- [x] 3.5 Calculate available height from window dimensions

### Step 4: Implement Input Bar
- [x] 4.1 Display ">" prompt indicator
- [x] 4.2 Show current input_buffer contents
- [x] 4.3 Add cursor indicator at end
- [x] 4.4 Apply appropriate styling

### Step 5: Handle Terminal Resize
- [x] 5.1 Verify resize events update Model.window
- [x] 5.2 Layout adapts to new dimensions
- [x] 5.3 Test at various terminal sizes

### Step 6: Write Tests
- [x] 6.1 Test view/1 returns proper render tree structure
- [x] 6.2 Test status bar content varies by state
- [x] 6.3 Test conversation renders messages correctly
- [x] 6.4 Test input bar shows buffer contents
- [x] 6.5 Test unconfigured state shows setup instructions

### Step 7: Documentation
- [x] 7.1 Update phase-04.md marking task complete
- [x] 7.2 Write summary document

## Technical Details

### View Helper Functions

```elixir
# Main view composition
def view(state) do
  stack(:vertical, [
    render_status_bar(state),
    render_conversation(state),
    render_input_bar(state)
  ])
end

# Status bar with provider, status, and hints
defp render_status_bar(state) do
  left = format_config(state.config)
  middle = format_status(state.agent_status)
  right = "Ctrl+C: Quit"

  text("#{left} | #{middle} | #{right}", Style.new(fg: :white, bg: :blue))
end

# Conversation with role-colored messages
defp render_conversation(state) do
  stack(:vertical, render_messages(state.messages, state.window))
end

# Input bar with prompt
defp render_input_bar(state) do
  text("> #{state.input_buffer}_", Style.new(fg: :white))
end
```

### Styling Constants

```elixir
@status_bar_style Style.new(fg: :white, bg: :blue)
@user_style Style.new(fg: :cyan)
@assistant_style Style.new(fg: :white)
@input_style Style.new(fg: :white)
@prompt_style Style.new(fg: :green)
```

## Success Criteria

1. Three-pane layout renders correctly
2. Status bar shows current config and status
3. Messages display with correct role colors
4. Input bar shows current buffer with cursor
5. Layout adapts to terminal resize
6. All tests pass
7. Credo checks pass

## Current Status

**Status**: Complete
**What Works**: Full three-pane layout with status bar, conversation, and input
**What's Next**: Task 4.2.2 Message Display enhancements
**How to Run**: `mix test test/jido_code/tui_test.exs`
