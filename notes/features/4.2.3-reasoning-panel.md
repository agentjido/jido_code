# Feature 4.2.3: Reasoning Panel

## Problem Statement

The TUI currently stores reasoning steps in the Model but doesn't display them to users. During complex queries, the agent performs Chain-of-Thought (CoT) reasoning with multiple steps (pending, active, complete), but users have no visibility into this process.

**Impact**: Users cannot see what the agent is "thinking" during processing, leading to a poor experience during long-running queries.

## Solution Overview

Implement an optional reasoning panel that:
1. Shows CoT reasoning steps with status indicators
2. Can be toggled on/off with Ctrl+R
3. Positions as a right sidebar on wide terminals, bottom drawer on narrow terminals
4. Highlights the currently executing step
5. Shows confidence scores after validation

### Already Implemented
- `reasoning_steps` field in Model ✓
- `{:reasoning_step, step}` message handling ✓
- `:clear_reasoning_steps` message handling ✓

### Needs Implementation
- `show_reasoning` toggle in Model
- `render_reasoning/1` view component
- Ctrl+R keybinding for toggle
- Adaptive panel positioning based on terminal width
- Step status indicators (pending/active/complete)
- Confidence score display

## Implementation Plan

### Step 1: Add show_reasoning to Model
- [x] 1.1 Add `show_reasoning` field to Model struct (default: false)
- [x] 1.2 Update init/1 to include show_reasoning
- [x] 1.3 Add type spec for show_reasoning

### Step 2: Add Ctrl+R Keybinding
- [x] 2.1 Handle Ctrl+R in event_to_msg → :toggle_reasoning
- [x] 2.2 Implement update for :toggle_reasoning
- [x] 2.3 Toggle flips show_reasoning boolean

### Step 3: Implement render_reasoning/1
- [x] 3.1 Create render_reasoning/1 component
- [x] 3.2 Display "Reasoning" header with toggle hint
- [x] 3.3 Render each step with status indicator
- [x] 3.4 Show pending steps with ○ (dim)
- [x] 3.5 Show active step with ● (yellow, highlighted)
- [x] 3.6 Show complete steps with ✓ (green)
- [x] 3.7 Show confidence score if present in step

### Step 4: Integrate Panel into Layout
- [x] 4.1 Update render_main_view to include reasoning panel conditionally
- [x] 4.2 Position as right sidebar when width >= 100
- [x] 4.3 Position as bottom drawer when width < 100
- [x] 4.4 Adjust conversation area width/height accordingly
- [x] 4.5 Update status bar hints to include "Ctrl+R: Reasoning"

### Step 5: Write Tests
- [x] 5.1 Test show_reasoning toggle
- [x] 5.2 Test Ctrl+R event handling
- [x] 5.3 Test render_reasoning with various step states
- [x] 5.4 Test panel positioning based on width
- [x] 5.5 Test confidence score display

### Step 6: Documentation
- [x] 6.1 Update phase-04.md marking task complete
- [x] 6.2 Write summary document

## Technical Details

### Step Status Indicators

```
Reasoning (Ctrl+R to hide)
─────────────────────────
○ Understanding query
● Analyzing code patterns
✓ Identifying dependencies
```

### Layout Positioning

**Wide terminal (width >= 100):**
```
┌──────────────────────────────────────────┬─────────────────────┐
│ Status bar                               │                     │
├──────────────────────────────────────────┤ Reasoning Panel     │
│                                          │ ○ Step 1            │
│ Conversation area                        │ ● Step 2 (active)   │
│                                          │ ✓ Step 3            │
├──────────────────────────────────────────┤                     │
│ > Input bar                              │                     │
└──────────────────────────────────────────┴─────────────────────┘
```

**Narrow terminal (width < 100):**
```
┌─────────────────────────────────────────────────────────────────┐
│ Status bar                                                       │
├─────────────────────────────────────────────────────────────────┤
│ Conversation area                                                │
├─────────────────────────────────────────────────────────────────┤
│ Reasoning: ○ Step 1 │ ● Step 2 │ ✓ Step 3                        │
├─────────────────────────────────────────────────────────────────┤
│ > Input bar                                                      │
└─────────────────────────────────────────────────────────────────┘
```

### Confidence Score Display

If a step has a confidence field, display it:
```
✓ Validated solution (confidence: 0.92)
```

## Success Criteria

1. Ctrl+R toggles reasoning panel visibility
2. Steps display with correct status indicators
3. Active step is highlighted
4. Panel positions correctly based on terminal width
5. Confidence scores display when present
6. All tests pass
7. Credo checks pass

## Current Status

**Status**: Complete
**What Works**: Reasoning panel with toggle, status indicators, confidence scores, adaptive layout
**What's Next**: Task 4.2.4 Status Bar enhancements
**How to Run**: `mix test test/jido_code/tui_test.exs`
