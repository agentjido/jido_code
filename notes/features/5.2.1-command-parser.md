# Feature: 5.2.1 Command Parser

## Problem Statement

The TUI currently has a stub `handle_command/2` function that displays "Commands not yet implemented" when users type commands starting with `/`. Users need to be able to configure the LLM provider and model at runtime without restarting the application.

## Solution Overview

Create a `JidoCode.Commands` module that parses and executes slash commands, returning results for TUI display. The TUI will delegate command handling to this module.

### Commands to Implement

| Command | Description |
|---------|-------------|
| `/model <provider>:<model>` | Set both provider and model |
| `/model <model>` | Set model for current provider |
| `/provider <provider>` | Set provider (clears model) |
| `/config` | Display current configuration |
| `/help` | List available commands |

Note: The `/models`, `/models <provider>`, and `/providers` commands require pick-list modals which are blocked pending term_ui refactoring (Task 4.3.1). These will be stubbed to show informational messages.

## Technical Details

### Files to Create
- `lib/jido_code/commands.ex` - Command parsing and execution module

### Files to Modify
- `lib/jido_code/tui.ex` - Update `handle_command/2` to use Commands module

### Dependencies
- `JidoCode.Settings` - For reading/writing configuration
- `Jido.AI.Model.Registry.Adapter` - For validating providers and models

## Implementation Plan

### Step 1: Create Commands module structure
- [x] 1.1 Create `JidoCode.Commands` module with moduledoc
- [x] 1.2 Define command result type: `{:ok, message} | {:error, message}`
- [x] 1.3 Add `execute/2` function that takes command text and current config

### Step 2: Implement command parsing
- [x] 2.1 Parse `/help` command
- [x] 2.2 Parse `/config` command
- [x] 2.3 Parse `/provider <provider>` command
- [x] 2.4 Parse `/model <provider>:<model>` command
- [x] 2.5 Parse `/model <model>` command (requires provider already set)
- [x] 2.6 Parse `/models` and `/providers` as stubs (pending pick-list)
- [x] 2.7 Handle unknown commands with error message

### Step 3: Implement command execution
- [x] 3.1 `/help` - Return list of available commands
- [x] 3.2 `/config` - Return current provider and model
- [x] 3.3 `/provider` - Validate provider, save to settings, return result
- [x] 3.4 `/model` - Validate model for provider, save to settings, return result

### Step 4: Integrate with TUI
- [x] 4.1 Update `handle_command/2` to call `Commands.execute/2`
- [x] 4.2 Handle command result - display message to user
- [x] 4.3 Update config in TUI state on success
- [x] 4.4 Broadcast config change via PubSub on success

### Step 5: Write tests
- [x] 5.1 Test `/help` returns command list
- [x] 5.2 Test `/config` returns current settings
- [x] 5.3 Test `/provider` with valid provider
- [x] 5.4 Test `/provider` with invalid provider
- [x] 5.5 Test `/model provider:model` sets both
- [x] 5.6 Test `/model model` with provider already set
- [x] 5.7 Test `/model model` without provider shows error
- [x] 5.8 Test unknown command returns error

## Success Criteria

1. `/help` lists all available commands
2. `/config` shows current provider and model
3. `/provider anthropic` sets provider and clears model
4. `/model anthropic:claude-3-5-sonnet` sets both provider and model
5. `/model gpt-4o` works when provider is already set
6. Invalid commands show helpful error messages
7. All tests pass

## Current Status

**Status**: Complete
**What Works**: All commands implemented and tested
**Tests**: 183 tests, 0 failures (20 command tests + 163 TUI tests)
**How to Run**: `mix test test/jido_code/commands_test.exs test/jido_code/tui_test.exs --exclude requires_api_key`

**Code Organization Notes:**
- Submit handlers prefixed with `do_` and moved after all `update/2` clauses to fix compiler warning about ungrouped clauses
