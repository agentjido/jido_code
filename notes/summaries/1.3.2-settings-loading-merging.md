# Summary: Task 1.3.2 - Settings Loading and Merging

## Overview

Implemented settings loading, merging, and caching functionality. Settings from global (`~/.jido_code/settings.json`) and local (`./jido_code/settings.json`) files are merged with local taking precedence, then cached in ETS for efficient access.

## Changes Made

### Modified Files
- `lib/jido_code/settings.ex` - Added load/get/reload/cache functions
- `test/jido_code/settings_test.exs` - Added 16 new tests

### JidoCode.Settings Module Updates

**New Public API:**
- `load/0` - Load and merge settings (uses cache)
- `get/1` - Get value by key, returns nil if missing
- `get/2` - Get value by key with default
- `reload/0` - Clear cache and reload from disk
- `clear_cache/0` - Clear the settings cache

**Caching:**
- Uses ETS table `:jido_code_settings_cache`
- Table created lazily on first access
- Cross-process accessible (`:public` table)
- Explicit invalidation via `reload/0` or `clear_cache/0`

**Merge Strategy:**
- Global settings loaded first as base
- Local settings overlayed (local wins on conflict)
- Deep merge for `models` key only (map of provider -> model lists)

**Error Handling:**
- Missing files treated as empty map (no error)
- Malformed JSON logs warning and treated as empty map
- Always returns `{:ok, map}`, never fails

### Tests Added (16 tests)

**load/0 tests:**
- Returns empty map when no settings files exist
- Returns ok tuple with map

**get/1 tests:**
- Returns nil for non-existent key
- Returns value for existing key

**get/2 tests:**
- Returns default for non-existent key
- Returns default as any type

**clear_cache/0 tests:**
- Returns ok
- Can be called multiple times

**reload/0 tests:**
- Returns ok tuple with map
- Clears cache and reloads

**Caching tests:**
- Load uses cache on second call
- Reload bypasses cache

**Merging tests:**
- Merges global and local with local precedence
- Deep merges models map

**Error handling tests:**
- Handles missing files gracefully
- Logs warning for malformed JSON

## Verification

- `mix test` - 84 tests, 0 failures (16 new)
- No compiler warnings

## Usage Example

```elixir
# Load merged settings
{:ok, settings} = JidoCode.Settings.load()
#=> {:ok, %{"provider" => "anthropic", "model" => "gpt-4o"}}

# Get individual values
JidoCode.Settings.get("provider")
#=> "anthropic"

JidoCode.Settings.get("missing_key", "default")
#=> "default"

# Force reload from disk
{:ok, fresh} = JidoCode.Settings.reload()
```

## Merge Behavior

```
# Global settings (~/.jido_code/settings.json)
{"provider": "anthropic", "model": "claude-3-opus"}

# Local settings (./jido_code/settings.json)
{"model": "gpt-4o"}

# Result after merge
{"provider": "anthropic", "model": "gpt-4o"}
```

## Notes

- ETS table is created on first access (lazy initialization)
- Cache must be manually invalidated via `reload/0`
- Task 1.3.3 will add `save/2` for persisting settings

## Next Steps

Task 1.3.3 - Settings Persistence (save/2, set/3, atomic writes)
