# Summary: Task 2.1.3 Agent Lifecycle Observability

## Overview

Added telemetry instrumentation for agent lifecycle events (start, stop, crash) with restart count tracking and optional Logger handler.

## Changes Made

### New Files

1. **`lib/jido_code/telemetry/agent_instrumentation.ex`**
   - `emit_start/2` - Emits `[:jido_code, :agent, :start]` event
   - `emit_stop/3` - Emits `[:jido_code, :agent, :stop]` event with duration
   - `emit_crash/3` - Emits `[:jido_code, :agent, :crash]` event with duration and restart_count
   - `restart_count/1` - Returns current restart count for agent
   - `reset_restart_count/1` - Manually resets restart count
   - `attach_logger/1` - Attaches Logger handler with configurable level
   - `detach_logger/0` - Detaches Logger handler
   - Uses ETS table for tracking start times and restart counts

2. **`test/jido_code/telemetry/agent_instrumentation_test.exs`**
   - 14 tests covering all telemetry functions

### Modified Files

1. **`lib/jido_code/agent_supervisor.ex`**
   - `start_agent/1` now emits start telemetry event
   - `stop_agent/1` now emits stop telemetry event (when stopped by name)
   - Added helper functions for storing/retrieving module info

2. **`test/jido_code/agent_supervisor_test.exs`**
   - Added 2 telemetry integration tests

## Telemetry Events

### `[:jido_code, :agent, :start]`
- Measurements: `%{system_time: integer()}`
- Metadata: `%{name: atom(), module: module()}`

### `[:jido_code, :agent, :stop]`
- Measurements: `%{duration: integer()}` (native time units)
- Metadata: `%{name: atom(), module: module(), reason: term()}`

### `[:jido_code, :agent, :crash]`
- Measurements: `%{duration: integer()}` (native time units)
- Metadata: `%{name: atom(), module: module(), reason: term(), restart_count: integer()}`

## Test Results

```
153 tests, 0 failures, 1 skipped
```

## API Usage

```elixir
# Attach logger for debugging
JidoCode.Telemetry.AgentInstrumentation.attach_logger(level: :info)

# Check restart count (useful for detecting restart loops)
count = JidoCode.Telemetry.AgentInstrumentation.restart_count(:my_agent)

# Attach custom handler for crash events
:telemetry.attach(
  "crash-alerter",
  [:jido_code, :agent, :crash],
  fn _event, _measurements, metadata, _config ->
    if metadata.restart_count > 3 do
      Logger.error("Restart loop detected for #{metadata.name}")
    end
  end,
  nil
)
```

## Phase Plan Updated

Task 2.1.3 marked complete in `notes/planning/proof-of-concept/phase-02.md`
