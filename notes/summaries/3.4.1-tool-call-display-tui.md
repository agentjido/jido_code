# Summary: 3.4.1 Tool Call Display (TUI Integration)

## Overview

Completed the TUI integration for tool call display. Tool calls and results are now visible in the conversation area with distinct styling, status indicators, and a toggle for showing/hiding detailed output.

## Files Modified

### lib/jido_code/tui.ex
Extended TUI module with tool call display:

**Model Changes:**
- Added `tool_calls: [tool_call_entry()]` - List of tool calls with results
- Added `show_tool_details: boolean()` - Toggle for detailed view
- Defined `tool_call_entry` type: call_id, tool_name, params, result, timestamp

**Message Handling:**
- `{:tool_call, tool_name, params, call_id}` - Adds pending tool call to list
- `{:tool_result, result}` - Matches result to call by tool_call_id
- `:toggle_tool_details` - Flips show_tool_details boolean

**Event Mapping:**
- Ctrl+T → `:toggle_tool_details`
- Plain 't' → `{:key_input, "t"}`

**Rendering Functions:**
- `format_tool_call_entry/2` - Returns list of render nodes for a tool call
- `render_tool_call_line/1` - Dimmed styling with "⚙" prefix and timestamp
- `render_tool_result_lines/2` - Status-based styling with duration
- `tool_result_style/1` - Returns icon and style for status

**Status Bar:**
- Added "Ctrl+T: Tools" / "Ctrl+T: Hide" hint

**Conversation Area:**
- Modified `render_conversation/1` to include tool calls
- Tool calls display after messages in conversation

## Display Format

```
[14:32] ⚙ read_file(path: "test.ex")
       ✓ read_file [45ms]: file contents here...

[14:32] ⚙ grep(pattern: "TODO", path: "lib")
       ✗ grep [12ms]: No matches found

[14:33] ⚙ slow_operation(data: {...})
       ⏱ slow_operation [30000ms]: Tool execution timed out
```

**Status Indicators:**
- ✓ Green - Success
- ✗ Red - Error
- ⏱ Yellow - Timeout
- ⋯ Dim - Executing (pending result)

## Test Coverage

### test/jido_code/tui_test.exs
Added 26 new tests (150 total):

**Field Tests:**
- Model defaults for tool_calls and show_tool_details
- init/1 sets correct initial values

**Toggle Tests:**
- Ctrl+T event mapping
- Plain 't' key handling
- toggle_tool_details state transitions

**Message Handling Tests:**
- tool_call adds entry to list
- tool_call appends to existing entries
- tool_call adds to message queue
- tool_result matches by call_id
- tool_result ignores unmatched calls
- tool_result handles error status
- tool_result handles timeout status
- tool_result adds to message queue

**Rendering Tests:**
- format_tool_call_entry with pending call
- format_tool_call_entry with success result
- format_tool_call_entry with error result
- format_tool_call_entry with timeout result
- Truncation when show_details is false
- Full content when show_details is true

**View Tests:**
- Status bar shows correct Ctrl+T hint
- Conversation shows tool calls
- No "empty" message when only tool calls present

## Dependencies

Uses existing modules:
- `JidoCode.Tools.Display` - format_tool_call/3, truncate_content/2
- `JidoCode.Tools.Result` - Result struct with status, content, duration_ms

## Key Design Decisions

1. **Tool calls stored separately** - Not mixed with messages, allows independent management
2. **Result matching by call_id** - Ensures correct result applied to correct call
3. **Truncation controlled by toggle** - Keeps display clean, full details on demand
4. **Status-based coloring** - Visual differentiation of success/error/timeout
5. **Timestamp display** - Same format as messages for consistency
