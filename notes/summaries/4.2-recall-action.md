# Task 4.2: Recall Action

## Summary

Implemented the Recall action for querying long-term memory. This allows the LLM agent to retrieve previously learned information filtered by type, confidence level, and text content.

## Implementation Details

### Files Created

**lib/jido_code/memory/actions/recall.ex**
- Created new Jido Action module for memory retrieval
- Implements `use Jido.Action` with comprehensive schema
- Parameters:
  - `query` (optional): Text search keywords for content matching
  - `type` (default: `:all`): Filter by memory type or get all types
  - `min_confidence` (default: 0.5): Minimum confidence threshold (0.0-1.0)
  - `limit` (default: 10, max: 50): Maximum memories to return
- Valid types: `:all`, `:fact`, `:assumption`, `:hypothesis`, `:discovery`, `:risk`, `:unknown`, `:decision`, `:convention`, `:lesson_learned`

**test/jido_code/memory/actions/recall_test.exs**
- 30 unit tests covering all requirements
- Tests for:
  - Type filtering (specific type, :all, no matches)
  - Confidence filtering (min threshold, clamping, range behavior)
  - Limit parameter (respects limit, validates range 1-50, default)
  - Text query (case-insensitive search, combined with filters, empty query)
  - Access tracking (updates access count for returned memories)
  - Result formatting (count, memory list, field structure)
  - Session ID handling (missing, nil, non-string errors)
  - Telemetry emission (duration, result count, metadata)
  - Type validation (invalid types rejected, all valid types accepted)
  - Constants (max_limit, min_limit, default_limit, valid_types)

### Key Features

1. **Flexible Filtering**: Filter by type, confidence, and text content
2. **Case-Insensitive Search**: Text queries are matched case-insensitively
3. **Access Tracking**: Updates access count for relevance ranking
4. **Limit Enforcement**: Respects limits (1-50 range)
5. **Confidence Clamping**: Uses `Types.clamp_to_unit/1` for validation
6. **Telemetry**: Emits `[:jido_code, :memory, :recall]` events with:
   - `duration`: Query duration in milliseconds
   - `result_count`: Number of memories returned
   - `session_id`, `type_filter`, `min_confidence`, `has_query`

### Result Format

```elixir
%{
  count: 3,
  memories: [
    %{
      id: "abc123...",
      content: "Phoenix uses Ecto for database access",
      type: :fact,
      confidence: 0.95,
      timestamp: "2024-01-01T12:00:00Z"
    },
    ...
  ]
}
```

### Directory Structure

```
lib/jido_code/memory/
├── actions/
│   ├── remember.ex           # Remember action (Task 4.1)
│   └── recall.ex             # NEW - Recall action
```

```
test/jido_code/memory/
├── actions/
│   ├── remember_test.exs     # 24 tests
│   └── recall_test.exs       # NEW - 30 tests
```

## Test Results

- All 30 Recall action tests pass
- All 541 memory tests pass (no regressions)

## Related Tasks

- Task 4.2.1: Action Definition - COMPLETE
- Task 4.2.2: Action Implementation - COMPLETE
- Task 4.2.3: Unit Tests - COMPLETE

## Notes

- Uses `Memory.query/2` and `Memory.query_by_type/3` for data retrieval
- Text filtering is applied after type/confidence filtering
- Access tracking uses `Memory.record_access/2` which is best-effort (doesn't fail on errors)
- Timestamp formatting handles nil and non-DateTime values gracefully
