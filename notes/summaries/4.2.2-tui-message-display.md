# Summary: 4.2.2 TUI Message Display

## Overview

Enhanced message display in the TUI with text wrapping for long messages, auto-scroll to show the latest message, and support for scrolling through message history with arrow keys.

## Implementation

### Model Changes

Added `scroll_offset` field to the Model struct:
- Default value: 0 (showing latest messages)
- Positive values scroll up through history

### Event Handling

Added arrow key handlers:
- Up arrow → `:scroll_up` - increases scroll_offset
- Down arrow → `:scroll_down` - decreases scroll_offset

### Scroll Update Handlers

```elixir
def update(:scroll_up, state) do
  max_offset = max(0, length(state.messages) - 1)
  new_offset = min(state.scroll_offset + 1, max_offset)
  {%{state | scroll_offset: new_offset}, []}
end

def update(:scroll_down, state) do
  new_offset = max(0, state.scroll_offset - 1)
  {%{state | scroll_offset: new_offset}, []}
end
```

### Auto-Scroll Behavior

Both `:submit` and `{:agent_response, content}` handlers now reset `scroll_offset` to 0, ensuring the user sees the latest message when they send a message or receive a response.

### Text Wrapping

Implemented word-aware text wrapping with:
- `wrap_text/3` - wraps text at word boundaries with different widths for first line and continuation
- `wrap_message/3` - handles the prefix and indentation for wrapped lines
- Continuation lines are indented to align with the message content after the prefix

Example output:
```
[14:30] You: This is a very long message that will wrap to
             multiple lines maintaining the indentation
             alignment with the first line content.
```

### Scroll Indicator

When scrolled up from the bottom, a scroll indicator appears:
```
  ↓ 3 more message(s) below
```

## Files Changed

- `lib/jido_code/tui.ex` - Added scroll_offset, event handlers, text wrapping
- `test/jido_code/tui_test.exs` - Added 15 new tests (60 total)
- `notes/planning/proof-of-concept/phase-04.md` - Task marked complete
- `notes/features/4.2.2-tui-message-display.md` - Planning document

## Tests Added

### Model Tests (2 tests updated)
- Default scroll_offset is 0
- scroll_offset field works correctly

### Event Handler Tests (2 new tests)
- Up arrow maps to :scroll_up
- Down arrow maps to :scroll_down

### Scroll Update Tests (6 new tests)
- :scroll_up increases scroll_offset
- :scroll_up caps at max offset
- :scroll_down decreases scroll_offset
- :scroll_down doesn't go below 0
- :submit resets scroll_offset
- :agent_response resets scroll_offset

### Text Wrapping Tests (6 new tests)
- Returns single line when text fits
- Wraps text at word boundaries
- Handles empty text
- Handles single word longer than width
- Handles multiple words requiring multiple lines
- Respects different first line and continuation widths

### View Tests (1 new test)
- Conversation shows scroll indicator when scrolled up

## Design Decisions

1. **Scroll offset from bottom**: 0 means showing latest, positive values scroll up - this feels natural for a chat interface
2. **Word-aware wrapping**: Wraps at word boundaries when possible for better readability
3. **Continuation indent**: Wrapped lines are indented to align with message content, not the timestamp/prefix
4. **Auto-scroll on new messages**: Both user and assistant messages reset scroll to show latest
5. **Scroll indicator**: Visual feedback when not at bottom

## Next Steps

Task 4.2.3 (Reasoning Panel) will add:
- Chain-of-Thought step display
- Toggle keybinding (Ctrl+R)
- Positioning based on terminal width
