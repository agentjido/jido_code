# Summary: 4.2.3 Reasoning Panel

## Overview

Implemented an optional reasoning panel that displays Chain-of-Thought (CoT) reasoning steps during complex queries. The panel can be toggled with Ctrl+R and adapts its position based on terminal width.

## Changes Made

### JidoCode.TUI Module (MODIFIED)

**New Model Field**:
- `show_reasoning` - Boolean toggle for panel visibility (default: false)

**New Event Handling**:
- `event_to_msg/2` for Ctrl+R → `:toggle_reasoning`
- `update(:toggle_reasoning, state)` - Flips show_reasoning boolean

**New View Components**:

1. **render_reasoning/1**: Full panel for wide terminals
   - Header: "Reasoning (Ctrl+R to hide)"
   - Step list with status indicators
   - Empty state handling

2. **render_reasoning_compact/1**: Single-line for narrow terminals
   - Format: "Reasoning: ○ Step 1 │ ● Step 2 │ ✓ Step 3"

3. **render_main_view_with_sidebar/1**: Wide terminal layout (width >= 100)
   - Horizontal stack with conversation + reasoning side-by-side

4. **render_main_view_with_drawer/1**: Narrow terminal layout (width < 100)
   - Compact reasoning line between conversation and input

**Step Status Indicators**:
- `○` (dim) - Pending step
- `●` (yellow, bold) - Active step
- `✓` (green) - Complete step

**Helper Functions**:
- `format_reasoning_step/1` - Formats individual step with indicator
- `step_indicator/1` - Returns indicator and style for status
- `format_confidence/1` - Formats confidence score when present
- `normalize_status/1` - Converts string/atom status to atom

**Updated Status Bar**:
- Shows "Ctrl+R: Reasoning" when panel is hidden
- Shows "Ctrl+R: Hide" when panel is visible

## Files Changed

### Modified Files
- `lib/jido_code/tui.ex` - Added reasoning panel (~130 new lines)
- `test/jido_code/tui_test.exs` - Added 19 new tests (91 → 110 tests)
- `notes/planning/proof-of-concept/phase-04.md` - Marked task complete
- `notes/features/4.2.3-reasoning-panel.md` - Updated status

### New Files
- `notes/summaries/4.2.3-reasoning-panel.md` - This summary

## Test Results

```
110 tests, 0 failures
```

New test coverage:
- show_reasoning field default value
- Ctrl+R event handling
- toggle_reasoning update
- render_reasoning with empty steps
- render_reasoning with pending/active/complete steps
- render_reasoning with confidence scores
- render_reasoning_compact format
- Status bar hints (Reasoning/Hide)
- Panel in view for wide/narrow terminals
- Panel hidden when show_reasoning is false

Credo passes with `--strict` on TUI module.

## Layout Examples

### Wide Terminal (width >= 100)
```
┌──────────────────────────────────────────┬─────────────────────┐
│ Status bar                               │                     │
├──────────────────────────────────────────┤ Reasoning           │
│                                          │ ○ Understanding     │
│ Conversation area                        │ ● Analyzing code    │
│                                          │ ✓ Found solution    │
├──────────────────────────────────────────┤                     │
│ > Input bar                              │                     │
└──────────────────────────────────────────┴─────────────────────┘
```

### Narrow Terminal (width < 100)
```
┌─────────────────────────────────────────────────────────────────┐
│ Status bar                                                       │
├─────────────────────────────────────────────────────────────────┤
│ Conversation area                                                │
├─────────────────────────────────────────────────────────────────┤
│ Reasoning: ○ Understanding │ ● Analyzing │ ✓ Found             │
├─────────────────────────────────────────────────────────────────┤
│ > Input bar                                                      │
└─────────────────────────────────────────────────────────────────┘
```

## Design Decisions

1. **Toggle Default**: Panel hidden by default to avoid clutter during simple queries

2. **Width Threshold**: 100 characters as breakpoint for sidebar vs drawer layout

3. **Status Indicators**: Unicode symbols (○●✓) for visual distinction across terminal themes

4. **Confidence Display**: Only shown when present in step data, formatted as "(confidence: 0.92)"

5. **Compact Mode**: Truncates step text to 15 chars for narrow display

6. **Dynamic Hints**: Status bar shows context-aware hint (Reasoning/Hide)

## What's Next

- **Task 4.2.4**: Status Bar enhancements with CoT indicator and more shortcuts
