# Summary: 4.2.3 TUI Reasoning Panel

## Overview

Implemented an optional reasoning panel that displays Chain-of-Thought (CoT) reasoning steps during complex queries. The panel is toggleable with Ctrl+R and positions itself as a right sidebar on wide terminals (>= 100 cols) or a bottom drawer on narrow terminals.

## Implementation

### Model Changes

Added `show_reasoning` boolean field to the Model struct:
- Default value: `false` (panel hidden)
- Toggled via Ctrl+R keybinding

### Event Handling

Added Ctrl+R handler:
```elixir
def event_to_msg(%Event.Key{key: :r, modifiers: modifiers}, _state) do
  if :ctrl in modifiers do
    {:msg, :toggle_reasoning}
  else
    {:msg, {:key_input, "r"}}
  end
end
```

### Toggle Update Handler

```elixir
def update(:toggle_reasoning, state) do
  {%{state | show_reasoning: not state.show_reasoning}, []}
end
```

### Panel Visibility Logic

Panel shows only when both conditions are met:
- `show_reasoning == true`
- `reasoning_steps` is not empty

### View Layout

Updated `view/1` to handle two layouts:

**Wide terminal (>= 100 cols)** - Right sidebar:
```
┌─────────────────────────────────┬──────────────────┐
│ Status Bar                      │ Reasoning (3)    │
├─────────────────────────────────┤ ✓ Step 1         │
│                                 │ ● Step 2         │
│ Conversation                    │ ○ Step 3         │
│                                 │                  │
├─────────────────────────────────┴──────────────────┤
│ > input                                            │
└────────────────────────────────────────────────────┘
```

**Narrow terminal (< 100 cols)** - Bottom drawer:
```
┌──────────────────────────────────┐
│ Status Bar                       │
├──────────────────────────────────┤
│ Conversation                     │
├──────────────────────────────────┤
│ Reasoning (3)                    │
│ ✓ Step 1 │ ● Step 2 │ ○ Step 3   │
├──────────────────────────────────┤
│ > input                          │
└──────────────────────────────────┘
```

### Status Indicators

| Status | Symbol | Style |
|--------|--------|-------|
| Pending | ○ | bright_black (dim) |
| Active | ● | yellow + bold |
| Complete | ✓ | green |

### Render Functions Added

- `render_reasoning_header/1` - Shows "Reasoning (N)" header with step count
- `render_reasoning_steps/1` - Renders vertical list of steps (for wide layout)
- `render_reasoning_panel/1` - Renders full panel with header and horizontal steps (for narrow layout)
- `render_reasoning_step/1` - Renders single step with indicator and text
- `format_step_inline/1` - Formats step for horizontal display
- `step_indicator/1` - Returns symbol and style for step status
- `render_wide_layout/1` - Three-row layout with horizontal splits for sidebar
- `render_narrow_layout/2` - Four-row layout with reasoning as bottom drawer

## Files Changed

- `lib/jido_code/tui.ex` - Added reasoning panel rendering and toggle functionality
- `test/jido_code/tui_test.exs` - Added 10 new tests (70 total)
- `notes/planning/proof-of-concept/phase-04.md` - Task marked complete
- `notes/features/4.2.3-tui-reasoning-panel.md` - Planning document updated

## Tests Added

### Model Tests (2 tests updated)
- Default show_reasoning is false
- show_reasoning field works correctly

### Event Handler Tests (2 new tests)
- Ctrl+R maps to :toggle_reasoning
- 'r' without Ctrl maps to {:key_input, "r"}

### Update Tests (2 new tests)
- :toggle_reasoning toggles from false to true
- :toggle_reasoning toggles from true to false

### View Tests (6 new tests)
- Reasoning panel hidden when show_reasoning is false
- Reasoning panel hidden when reasoning_steps is empty
- Reasoning panel shows as bottom drawer for narrow terminals
- Reasoning panel shows as right sidebar for wide terminals
- Reasoning panel displays step status indicators
- Reasoning panel step styling uses correct colors

## Design Decisions

1. **Dual layout system**: Wide terminals (>= 100 cols) use a sidebar layout to maximize vertical space; narrow terminals use a bottom drawer to maintain conversation width
2. **Explicit toggle required**: Panel must be explicitly shown with Ctrl+R even when steps are present, giving users control over their interface
3. **Horizontal compact display**: In narrow mode, steps are displayed horizontally with │ separators to minimize vertical space usage
4. **Consistent indicators**: Unicode symbols (○, ●, ✓) provide clear visual status at a glance
5. **Color-coded styling**: Green for complete, yellow for active, dim for pending matches common conventions

## Next Steps

Task 4.2.4 (Status Bar) will add:
- Enhanced status bar with colored indicators
- Keyboard shortcut hints display
- Provider/model configuration display improvements
